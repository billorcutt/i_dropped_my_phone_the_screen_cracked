<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>plugins/distortion.cracked.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><ul><li><h3><a href="cracked.html">cracked</a></h3><ul class='methods'><li><h5 style="font-size:15px">Find</h5></li><li data-type='method'><a href="cracked.html#reset">reset</a></li><li data-type='method'><a href="cracked.html#exec">exec</a></li><li data-type='method'><a href="cracked.html#each">each</a></li><li data-type='method'><a href="cracked.html#filter">filter</a></li><li data-type='method'><a href="cracked.html#find">find</a></li><li><h5 style="font-size:15px">Control</h5></li><li data-type='method'><a href="cracked.html#start">start</a></li><li data-type='method'><a href="cracked.html#stop">stop</a></li><li data-type='method'><a href="cracked.html#ramp">ramp</a></li><li data-type='method'><a href="cracked.html#attr">attr</a></li><li><h5 style="font-size:15px">Node</h5></li><li data-type='method'><a href="cracked.html#script">script</a></li><li data-type='method'><a href="cracked.html#waveshaper">waveshaper</a></li><li data-type='method'><a href="cracked.html#compressor">compressor</a></li><li data-type='method'><a href="cracked.html#gain">gain</a></li><li data-type='method'><a href="cracked.html#native_delay">native_delay</a></li><li data-type='method'><a href="cracked.html#osc">osc</a></li><li data-type='method'><a href="cracked.html#biquadFilter">biquadFilter</a></li><li data-type='method'><a href="cracked.html#convolver">convolver</a></li><li data-type='method'><a href="cracked.html#stereoPanner">stereoPanner</a></li><li data-type='method'><a href="cracked.html#destination">destination</a></li><li data-type='method'><a href="cracked.html#origin">origin</a></li><li data-type='method'><a href="cracked.html#buffer">buffer</a></li><li><h5 style="font-size:15px">Sequence</h5></li><li data-type='method'><a href="cracked.html#loop">loop</a></li><li data-type='method'><a href="cracked.html#bind">bind</a></li><li data-type='method'><a href="cracked.html#unbind">unbind</a></li><li><h5 style="font-size:15px">Macro</h5></li><li data-type='method'><a href="cracked.html#begin">begin</a></li><li data-type='method'><a href="cracked.html#end">end</a></li><li><h5 style="font-size:15px">Midi</h5></li><li data-type='method'><a href="cracked.html#midi_supported">midi_supported</a></li><li data-type='method'><a href="cracked.html#midi_init">midi_init</a></li><li data-type='method'><a href="cracked.html#midi_receive">midi_receive</a></li><li data-type='method'><a href="cracked.html#midi_noteon">midi_noteon</a></li><li data-type='method'><a href="cracked.html#midi_noteoff">midi_noteoff</a></li><li data-type='method'><a href="cracked.html#midi_control">midi_control</a></li><li><h5 style="font-size:15px">Connect</h5></li><li data-type='method'><a href="cracked.html#connect">connect</a></li><li data-type='method'><a href="cracked.html#remove">remove</a></li><li><h5 style="font-size:15px">Debug</h5></li><li data-type='method'><a href="cracked.html#log">log</a></li><li data-type='method'><a href="cracked.html#size">size</a></li><li data-type='method'><a href="cracked.html#_dumpState">_dumpState</a></li><li data-type='method'><a href="cracked.html#_getNode">_getNode</a></li><li><h5 style="font-size:15px">Type</h5></li><li data-type='method'><a href="cracked.html#ifUndef">ifUndef</a></li><li data-type='method'><a href="cracked.html#isNotUndef">isNotUndef</a></li><li data-type='method'><a href="cracked.html#isUndef">isUndef</a></li><li data-type='method'><a href="cracked.html#isObj">isObj</a></li><li data-type='method'><a href="cracked.html#isNum">isNum</a></li><li data-type='method'><a href="cracked.html#isStr">isStr</a></li><li data-type='method'><a href="cracked.html#isArr">isArr</a></li><li data-type='method'><a href="cracked.html#isFun">isFun</a></li><li><h5 style="font-size:15px">Algorithmic</h5></li><li data-type='method'><a href="cracked.html#random_interval">random_interval</a></li><li data-type='method'><a href="cracked.html#random_envelope">random_envelope</a></li><li data-type='method'><a href="cracked.html#fill_array">fill_array</a></li><li data-type='method'><a href="cracked.html#array_next">array_next</a></li><li data-type='method'><a href="cracked.html#chance">chance</a></li><li data-type='method'><a href="cracked.html#scales">scales</a></li><li data-type='method'><a href="cracked.html#chords">chords</a></li><li data-type='method'><a href="cracked.html#random_scale">random_scale</a></li><li data-type='method'><a href="cracked.html#random_arpeggio">random_arpeggio</a></li><li data-type='method'><a href="cracked.html#shuffle">shuffle</a></li><li data-type='method'><a href="cracked.html#random">random</a></li><li data-type='method'><a href="cracked.html#throttleFactory">throttleFactory</a></li><li><h5 style="font-size:15px">Delay</h5></li><li data-type='method'><a href="cracked.html#reverb">reverb</a></li><li data-type='method'><a href="cracked.html#delay">delay</a></li><li data-type='method'><a href="cracked.html#comb">comb</a></li><li><h5 style="font-size:15px">Distortion</h5></li><li data-type='method'><a href="cracked.html#bitcrusher">bitcrusher</a></li><li data-type='method'><a href="cracked.html#ring">ring</a></li><li data-type='method'><a href="cracked.html#overdrive">overdrive</a></li><li><h5 style="font-size:15px">Envelope</h5></li><li data-type='method'><a href="cracked.html#adsr">adsr</a></li><li><h5 style="font-size:15px">Filter</h5></li><li data-type='method'><a href="cracked.html#lowpass">lowpass</a></li><li data-type='method'><a href="cracked.html#highpass">highpass</a></li><li data-type='method'><a href="cracked.html#bandpass">bandpass</a></li><li data-type='method'><a href="cracked.html#lowshelf">lowshelf</a></li><li data-type='method'><a href="cracked.html#highshelf">highshelf</a></li><li data-type='method'><a href="cracked.html#peaking">peaking</a></li><li data-type='method'><a href="cracked.html#notch">notch</a></li><li data-type='method'><a href="cracked.html#allpass">allpass</a></li><li><h5 style="font-size:15px">Miscellaneous</h5></li><li data-type='method'><a href="cracked.html#clip">clip</a></li><li data-type='method'><a href="cracked.html#dac">dac</a></li><li data-type='method'><a href="cracked.html#adc">adc</a></li><li data-type='method'><a href="cracked.html#out">out</a></li><li data-type='method'><a href="cracked.html#in">in</a></li><li data-type='method'><a href="cracked.html#panner">panner</a></li><li data-type='method'><a href="cracked.html#sampler">sampler</a></li><li><h5 style="font-size:15px">Modulator</h5></li><li data-type='method'><a href="cracked.html#lfo">lfo</a></li><li data-type='method'><a href="cracked.html#stepper">stepper</a></li><li><h5 style="font-size:15px">Noise</h5></li><li data-type='method'><a href="cracked.html#noise">noise</a></li><li data-type='method'><a href="cracked.html#pink">pink</a></li><li data-type='method'><a href="cracked.html#white">white</a></li><li data-type='method'><a href="cracked.html#brown">brown</a></li><li><h5 style="font-size:15px">Oscillator</h5></li><li data-type='method'><a href="cracked.html#sine">sine</a></li><li data-type='method'><a href="cracked.html#square">square</a></li><li data-type='method'><a href="cracked.html#saw">saw</a></li><li data-type='method'><a href="cracked.html#triangle">triangle</a></li><li><h5 style="font-size:15px">Setters</h5></li><li data-type='method'><a href="cracked.html#frequency">frequency</a></li><li data-type='method'><a href="cracked.html#detune">detune</a></li><li data-type='method'><a href="cracked.html#type">type</a></li><li data-type='method'><a href="cracked.html#volume">volume</a></li><li data-type='method'><a href="cracked.html#time">time</a></li><li data-type='method'><a href="cracked.html#feedback">feedback</a></li><li data-type='method'><a href="cracked.html#speed">speed</a></li><li data-type='method'><a href="cracked.html#drive">drive</a></li><li data-type='method'><a href="cracked.html#distortion">distortion</a></li><li data-type='method'><a href="cracked.html#q">q</a></li><li data-type='method'><a href="cracked.html#pan">pan</a></li><li><h5 style="font-size:15px">Synth</h5></li><li data-type='method'><a href="cracked.html#monosynth">monosynth</a></li><li data-type='method'><a href="cracked.html#polysynth">polysynth</a></li><li><h5 style="font-size:15px">Utility</h5></li><li data-type='method'><a href="cracked.html#play">play</a></li><li data-type='method'><a href="cracked.html#scale">scale</a></li><li data-type='method'><a href="cracked.html#sec2ms">sec2ms</a></li><li data-type='method'><a href="cracked.html#ms2sec">ms2sec</a></li><li data-type='method'><a href="cracked.html#isSupported">isSupported</a></li><li data-type='method'><a href="cracked.html#pitch2freq">pitch2freq</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">plugins/distortion.cracked.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Bitcrusher
 *
 * [See more bitcrusher examples](examples/distortion.html)
 *
 * @plugin
 * @category Distortion
 * @function
 * @memberof cracked
 * @name cracked#bitcrusher
 * @param {Object} [params] map of optional values
 * @param {Number} [params.frequency=0.1]
 * @param {Number} [params.bits=6]
 */
cracked.bitcrusher = function (params) {
//adapted from http://noisehack.com/custom-audio-effects-javascript-web-audio-api/
    params = params || {};

    __.begin("bitcrusher", params);

    __.script({
        fn: (function (options) {

            var bits = options.bits || 6; // between 1 and 16
            var normfreq = __.ifUndef(options.frequency, 0.1); // between 0.0 and 1.0
            var step = Math.pow(1 / 2, bits);
            var phaser = 0;
            var last = 0;

            function crusher(e) {
                var input = e.inputBuffer.getChannelData(0);
                var output = e.outputBuffer.getChannelData(0);
                for (var i = 0; i &lt; 4096; i++) {
                    phaser += normfreq;
                    if (phaser >= 1.0) {
                        phaser -= 1.0;
                        last = step * Math.floor(input[i] / step + 0.5);
                    }
                    output[i] = last;
                }
            }

            return crusher;

        })(params)
    });

    __.end("bitcrusher");

    return cracked;

};

/**
 * Ring Modulator
 *
 * [See more ring modulator examples](examples/distortion.html)
 *
 * @plugin
 * @category Distortion
 * @function
 * @memberof cracked
 * @name cracked#ring
 * @param {Object} [params] map of optional values
 * @param {Number} [params.distortion=1]
 * @param {Number} [params.frequency=30]
 */
cracked.ring = function (params) {
//adapted from http://webaudio.prototyping.bbc.co.uk/ring-modulator/
    var options = params || {};

    var thisCurve = setCurve(__.ifUndef(options.distortion, 1));

    __.begin("ring", params);

    __.gain({
        id: "player"
    }).
        gain({
            id: "vcInverter1",
            gain: -1
        }).
        waveshaper({
            id: "vcDiode3",
            curve: thisCurve,
            mapping: {
                "distortion": {
                    "path": "curve",
                    "fn": (function () {
                        return setCurve;
                    })()
                }
            }
        }).
        compressor({
            threshold: -12
        });

    __("#player").
        waveshaper({
            id: "vInDiode4",
            curve: thisCurve,
            mapping: {
                "distortion": {
                    "path": "curve",
                    "fn": (function () {
                        return setCurve;
                    })()
                }
            }
        }).
        connect("compressor");

    __().sine({
        id: "vIn",
        frequency: options.frequency || 30,
        mapping: {
            "frequency": "frequency.value"
        }
    }).
        gain({
            id: "vInGain",
            gain: 0.5
        }).
        gain({
            id: "vInInverter1",
            gain: -1
        }).
        gain({
            id: "vInInverter2",
            gain: -1
        }).
        waveshaper({
            id: "vInDiode1",
            curve: thisCurve,
            mapping: {
                "distortion": {
                    "path": "curve",
                    "fn": (function () {
                        return setCurve;
                    })()
                }
            }
        }).
        gain({
            id: "vInInverter3",
            gain: -1
        }).
        connect("compressor");

    __("#vInGain").
        connect("#vInDiode4");

    __("#vInGain").
        connect("#vcInverter1");

    __("#vInInverter1").
        waveshaper({
            id: "vInDiode2",
            curve: thisCurve,
            mapping: {
                "distortion": {
                    "path": "curve",
                    "fn": (function () {
                        return setCurve;
                    })()
                }
            }
        }).
        connect("#vInInverter3");

    __("compressor").
        gain({
            id: "outGain",
            gain: 4
        });

    __.end("ring");

    return cracked;

    function setCurve(distortion) {

        var i, samples, v, value, wsCurve, _i, _ref, vb, vl, h;

        vb = 0.2;
        vl = 0.4;
        h = __.ifUndef(distortion, 1);

        samples = 1024;
        wsCurve = new Float32Array(samples);

        for (i = _i = 0, _ref = wsCurve.length; 0 &lt;= _ref ? _i &lt; _ref : _i > _ref; i = 0 &lt;= _ref ? ++_i : --_i) {
            v = (i - samples / 2) / (samples / 2);
            v = Math.abs(v);
            if (v &lt;= vb) {
                value = 0;
            } else if ((vb &lt; v) &amp;&amp; (v &lt;= vl)) {
                value = h * ((Math.pow(v - vb, 2)) / (2 * vl - 2 * vb));
            } else {
                value = h * v - h * vl + (h * ((Math.pow(vl - vb, 2)) / (2 * vl - 2 * vb)));
            }
            wsCurve[i] = value;
        }
        return wsCurve;
    }

};
//adapted from https://github.com/web-audio-components
/**
 * Overdrive, waveshaper with additional parameters
 *
 * [See more overdrive examples](examples/distortion.html)
 *
 * @plugin
 * @category Distortion
 * @function
 * @memberof cracked
 * @name cracked#overdrive
 * @param {Object} [params] map of optional values
 * @param {Number} [params.drive=0.5]
 * @param {Number} [params.color=800]
 * @param {Number} [params.postCut=3000]
 */
cracked.overdrive = function (params) {

    params = params || {};
    var drive = __.isObj(params) ? __.ifUndef(params.drive, 0.5) : params;

    __.begin("overdrive", params);

    __.gain({
        id: "input"
    }).
        bandpass({
            frequency: __.ifUndef(params.color, 800),
            mapping: {
                "color": "frequency.value"
            }
        }).
        waveshaper({
            curve: makeCurve(drive),
            mapping: {
                "drive": {
                    "path": "curve",
                    "fn": (function () {
                        return makeCurve;
                    })()
                }
            }
        }).
        lowpass({
            frequency: __.ifUndef(params.postCut, 3000),
            mapping: {
                "postCut": "frequency.value"
            }
        }).
        gain({
            id: "output"
        });

    __.end("overdrive");

    function makeCurve(value) {
        var k = value * 100,
            n = 22050,
            curve = new Float32Array(n),
            deg = Math.PI / 180;

        for (var i = 0; i &lt; n; i++) {
            var x = i * 2 / n - 1;
            curve[i] = (3 + k) * x * 20 * deg / (Math.PI + k * Math.abs(x));
        }
        return curve;
    }

    return cracked;

};</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun Jul 16 2017 13:41:59 GMT-0700 (PDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
